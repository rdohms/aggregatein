{% extends "base.html.twig" %}

{% block content %}

<div class="page-header">
    <span class="permalink"><a href="{{ url('talk_show', { 'slug': aggregation.slug }) }}">{{ url('talk_show', { 'slug': aggregation.slug }) }}</a></span>    
    <h1>{{ aggregation.title }}</h1>
    <span>By <a href="{{ aggregation.speakerUrl|default('#') }}">{{ aggregation.speakerName|default('Anonymous') }}</a></span>
</div>
<div class="row-fluid">
    <div class="span10">
        <h3>Events</h3>
        <ul class="unstyled talk-list">
            {% for talk in summary.talks %}
            <li>
                <div class="rating">
                    <img src="/img/rating-{{ talk.rating }}.gif" alt="">
                </div>
                <a href="{{ talk.eventUrl }}">{{ talk.eventName|default("Event without name") }}</a><br>
                <em>"{{ talk.title }}"</em>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="span2">
        <div class="well center">
            <h3>Overall</h3>
            <p class="rating-value">
                {{ summary.stats.getAverageRating() }}
            </p>
            <p>based on <strong>{{summary.stats.getTotalCount() }}</strong> ratings</p>
        </div>
    </div>
</div>
<div class="row-fluid">
    <div id="graph" class="span12"></div>
</div>

{% endblock %}

{% block javascripts %}
{{ parent() }}

<script type="text/javascript" charset="utf-8">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'graph',
                type: 'line',
                marginRight: 0,
                marginBottom: 25,
     
            },
            title: {
                text: 'Evolution of Ratings',
                x: -20 //center
            },
            xAxis: {
                categories: {{ summary.graphDates|json_encode|raw }}
            },
            yAxis: {
                title: {
    				text: 'Rating'
    			},
    			min: 0,
    			max: 5.5,
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },

            legend: {
                enabled: false
            },
            series: [{
                data: {{ summary.graphRatings|json_encode }}
            }]
        });
    });
    
});
</script>

<script src="/js/highcharts.js" type="text/javascript" charset="utf-8"></script>
{% endblock %}